
# 단일 서버

![](https://github.com/devyuseon/system-design-interview/assets/67352902/3a56b326-117d-40a0-ab3c-f7704d6ea841)

1. 사용자는 도메인 이름으로 웹사이트에 접속하고, DNS 서버를 거쳐 ip주소가 반환된다.
2. 해당 IP주소로 HTTP요청이 전달된다.
3. 요청받은 웹 서버가 HTML페이지나 JSON 형태의 응답을 반환한다.

# 데이터베이스

사용자가 늘면 서버 하나로는 힘들다. HTTP 요청을 처리하는 서버와 데이터베이스 서버를 분리해 독립적으로 확장해 나갈 수 있다.

<img width="592" alt="image" src="https://github.com/devyuseon/system-design-interview/assets/67352902/98f92e87-16b7-4cd9-9e1a-6f687afa232e">

## 어떤 데이터베이스를 사용할 것인가?

### RDBMS vs NoSQL

**📍 RDBMS: 관계형 데이터베이스**
- 자료를 열, 칼럼으로 표현
- 테이블 관계를 join하여 합칠 수 있다
- MySQL, 오라클, PostgreSQL 등

**📍 NoSQL: 비 관계형 데이터베이스**
- CouchDB, Neo4j, Cassandra, HBase, Amazon DynamoDB
- 종류
  - key-value store
  - graph store
  - column store
  - document store

#### NoSQL이 적합한 때

- very low latency 요구될때
- 다루는 데이터가 비정형 데이터
- 단순히 데이터를 직렬화/역직렬화 하기 위함
- 대량의 데이터 저장

## 수직적 규모 확장 vs 수평적 규모 확장

`Scale Up`은 서버에 CPU나 RAM등을 추가하는 것, `Scale Out`은 더 많은 서버를 추가해 성능을 개선하는 것이다.

- 수직적 규모 확장에는 한계가 있다.
- 수직적 규모 확장법은 failover, 다중화가 되지 않아 서버 하나가 장애가 나면 아예 서비스 장애가 됨

이런 이유에서 대규모 시스템을 설계할때에는 `Scale Out`이 적절하다.<br/>
위의 설계에서 웹서버 하나가 다운되거나 트래픽이 몰려 응답시간이 느려지면 서버 접속이 불가능해진다.<br/>
이럴때 **로드밸런서**를 도입한다.

## 로드밸런서

<img width="600" alt="image" src="https://github.com/devyuseon/system-design-interview/assets/67352902/b799224f-fa61-41ae-8d8a-cd80f73b3cba">

- 사용자는 Public IP로 접속한다.
- 서버간 통신은 Private IP로 통신한다.

서버가 하나 다운되었을때, 다른 서버가 대체하면 되고, 두 서버가 트래픽을 분산할 수 있다. 더 확장하고 싶다면 서버만 한대 추가하면 된다.

하지만 데이터베이스 서버는 아직 failover나 다중화를 지원하지 않는다.

## 데이터베이스 다중화

### Master-Slave 모델

- 데이터 원본은 Master 서버에, 사본은 Slave 서버에
- 쓰기 연산은 Master 서버에서만 지원
  - 예를들어 insert, delete, update 명령어 
- Slave 서버는 그 사본을 전달받고, 읽기 연산만 지원
- 보통의 어플리케이션은 읽기 연산이 많아 Slave 서버를 많이 둠

**📍 데이터베이스 다중화 성능적 이점**

- 더 나은 성능
- 안전성
- 가용성

<img width="495" alt="image" src="https://github.com/devyuseon/system-design-interview/assets/67352902/af91b085-030c-485b-b748-01fde7fab57f">

이 그림에서, 부 서버가 다운되면 주 서버로 읽기 연산이 전달되고, 다른 부 서버가 장애서버를 대체한다.
주 버서가 다운되면 부 서버가 주 서버를 대신한다. **하지만** 부 서버의 데이터가 최신임은 보장할 수 없다.
없는 데이터는 복구 스크립트를 돌려야 한다. 다중 마스터나 원형 다중화 방식을 도입할 수 있다.

<img width="608" alt="image" src="https://github.com/devyuseon/system-design-interview/assets/67352902/f1577e2e-3f8d-4e4a-9f95-b34281b0e0b3">

로드벨런서와 데이터베이스 다중화까지 한 모습이다.

# 캐시

## 캐시 계층

<img width="598" alt="image" src="https://github.com/devyuseon/system-design-interview/assets/67352902/6a11cb74-3f55-4dc9-8ab8-68c0eae16458">

별도의 캐시 서버를 두면 데이터베이스 부하를 줄이고, 데이터베이스보다 훨씬 빠르게 응답할 수 있다.

> **주도형 캐시 전략**
> 1. 캐시 확인
> 2. 있으면 캐시의 데이터 응답
> 3. 없으면 캐시에 저장하고 응답
