# 7장 분산 시스템을 위한 유일 ID 생성기 설계

## 요구사항

- 유일해야 함
- 숫자로만 구성되어야 함
- 64비트로 표현될 수 있어야 함
- 발급 날짜에 따라 정렬되어야 함
- 초당 10,000개의 ID를 만들 수 있어야 함

## 다중 마스터 복제

- 데이터베이스의 auto_increment 기능 이용
- 1씩이 아니라 현재 사용중인 데이터베이스 수 k 만큼 증가시킴

**장점**<br/>

- ID 유일성은 보장됨

**단점**<br/>

- 여러 데이터센터에 걸쳐 규모를 늘리기 어려움
- 시간에 흐름에 맞게 늘어난다는 것을 보장할 수 없음
- 서버 추가시 잘 동작할 수 있게 만들기 어려움

## UUID

*UUID가 중복될 가능성은 거의 없다.

**장점**<br/>

- 단순
- 규모 확장이 쉬움

**단점**<br/>

- ID가 128비트로 김
- 시간순 정렬 불가능
- 숫자가 아닌 값이 포함될 수 있음

## 티켓 서버

auto_increment 기능을 갖춘 데이터베이스를 외부에 하나 두는 것. 티켓 서버를 중앙 집중형으로 하나만 사용한다.

**장점**<br/>

- 오직 숫자로만 구성된 ID를 얻을 수 있다.
- 구현하기 쉽고, 소규모라면 적합하다.

**단점**<br/>

- 티켓 서버가 SPOF 지점이 될 수 있다.

## 트위터 스노플레이크 접근법

링크: https://github.com/twitter-archive/snowflake/tree/b3f6a3c6ca8e1b6847baa6ff42bf72201e2c2231

- sign비트 / 타임스탬프 / 데이터센터 ID / 서버ID / 일련번호 로 구성한다.
- 모든 요구사항을 만족한다.
- 타임스탬프를 41비트로 할당하였을 때 69년동안 이 Id 생성기를 사용할 수 있게 된다.

# 8장

## 요구사항

- URL 단축
- URL 리디렉션: 축약된 URL로 HTTP 요청이 오면 원래 URI로 안내
- 높은 가용성과 규모 확장성, 그리고 장애감내가 요구됨

## URL 리디렉션

short url로 요청이 왔을때, 원래의 url로 리디렉션 해줘야 한다. 응답코드로 301이나 302를 보낼 수 있는데, 두 응답에 차이가 있다.

### 301 Permanently Moved

- 영구 이동을 뜻한다.
- 브라우저는 이 응답을 캐싱한다.
- 추가) SEO의 관점에서 / 301로 리디렉션 했을 경우 사이트 랭크와 포탈 점수또한 새 url로 이동되며, 기존 url은 없는것으로 취급한다. 포털 검색에도 새 url만 보이게 된다.

### 302 Found

- 임시 이동을 뜻한다.
- 브라우저는 이 응답을 기본적으로 캐싱하지는 않는다. Cache-control과 Expire등이 있을때 캐싱한다.
- 추가) 사이트 랭크와 평가점수를 이동하지 않고, 컨텐츠만 리디렉션 되는 것이다.

## URL 단축 해시함수

잘 알려진 해시함수 (CRC32, MD5, SHA-1)등을 사용해 해싱할 수 있으나, 길다. 일부만 사용하면 중복될 확률이 높아진다. 중복 여부를 체크하기 위해 데이터베이스를 매번 조회하는 부담도 있다.

### base-62변환

- hashValue에 쓸 수 있는 문자가 62개이다.
- 62진법으로 변환해 표현한다.

### 해시 후 충돌 해소 전략 vs base62 변환

|해시 후 충돌 해소 전략|base-62 변환|
|---|---|
|단축 URL의 길이가 고정됨|단축 URL의 길이가 가변적. ID값이 커지면 같이 길어짐|
|유일성이 보장되는 ID 생성기가 필요치 않음|유일성 보장 ID 생성기가 필요|
|충돌이 가능해서 해소 전략이 필요|ID의 유일성이 보장된 후에야 적응 가능하므로 충돌 불가|
|ID로부터 단축 URL을 계산하는 방식이 아니라서 다음에 쓸 수 있는 URL을 알아내는 것이 불가능|ID가 1씩 증가하는 값이라고 가정하면 다음에 쓸 수 있는 단축 URL이 무엇인지 쉽게 알아낼 수 있어 보안상 문제가 될 수 있음|

# 질문
