# 5장 안정 해시 설계

서버를 수평적으로 확장하기 위해서 요청 또는 데이터를 여러 서버에 균등하게 나눠야 한다. 이때 사용하는 것이 **안정 해시** 기술이다.

## 해시 키 재배치 문제

```
serverIndex = hash(key) % N (N은 서버의 개수)
```
- 이렇게 해싱하여 서버에 분배했을때 하나의 서버가 장애가 발생하면 나머지 서버만 가지고 다시 키를 재분배 해야 한다.
- 장애가 난 서버 뿐만 아니라 , 대부분의 서버가 재분배가 이루어 진다.
- 이때 사용하는것이 안정해시 이다.

## 안정 해시

## 해시 공간과 해시 링

- 해시 공간을 구부려 시작점과 끝점이 만나게 하면 그것이 **해시 링** 이다.
- SHA-1의 해시 공간은 0부터 2^160 - 1 이다.
- 이 해시공간 위에 서버를 위치하고, 해시함수에 의한 값의 위치에서 오른쪽으로 돌다 처음 만나는 서버가 저장될 서버가 된다.
- 이렇게 하면 서버가 추가되거나 제거되었을때 일부 공간만 재배치 하면 된다.
- 다만 이렇게 했을때 두가지 문제가 있다.
  - 서버가 추가되거나 제거되었을때 파티션의 크기를 균등하게 유지하는것이 불가능하다.
    - 파티션: 서버와 서버 사이의 공간
  - 키의 균등 분포를 달성하기 힘들다.
- 이때 제안하는 방법이 **가상 노드**이다.

## 가상 노드

- 한 서버가 여러개의 파티션을 관리하는 기법이다.
- 가상노드가 많아질수록 키는 균등하게 분포된다.
  - 표준편차가 작아지기 때문이다.
- 하지만 가상노드가 많아질수록 저장공간이 많이 필요하다.
- trade off 를 따져가며 적절한 가상노드의 수 산정이 필요하다. 


# 6장 
